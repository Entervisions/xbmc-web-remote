<?xml version="1.0"?>
<project name="XBMC-Remote" basedir="./">

	<property file="build.properties"/>


    <target name="package_web" depends="clean" description="Create package for Web">

        <delete dir="${target.folder}/${project_name}" />

        <copy todir="${target.folder}/${project_name}/">
            <fileset dir="${src.folder}/"/>
        </copy>

        <copy todir="${target.folder}/${project_name}/">
            <fileset file="res/js/offline.appcache"/>
        </copy>

        <script language="javascript">
            <![CDATA[
                property = project.setProperty("timenow", Math.floor((new Date()).getTime()));
            ]]>
        </script>

        <replace file="${target.folder}/${project_name}/js/enum.js" token="@allow_popout" value="false"/>
        <replace file="${target.folder}/${project_name}/about.html" token="@build_version" value="${build.version}"/>
        <replace file="${target.folder}/${project_name}/offline.appcache" token="@build_time" value="${timenow}"/>
        <replace file="${target.folder}/${project_name}/remote.html" token="@manifest" value=' manifest="offline.appcache"'/>
        <replace file="${target.folder}/${project_name}/settings.html" token="@manifest" value=' manifest="offline.appcache"'/>

    </target>


    <target name="package_chrome_extension" depends="clean" description="Package folder for Chrome extension developer mode and .zip for Web Store">
        <mkdir dir="${chrome_extension.folder}/${project_name}/"/>

        <copy todir="${chrome_extension.folder}/${project_name}/">
            <fileset dir="${src.folder}/"/>
        </copy>

        <copy todir="${chrome_extension.folder}/${project_name}/">
            <fileset file="res/js/manifest.json"/>
        </copy>

        <replace file="${chrome_extension.folder}/${project_name}/js/enum.js" token="@allow_popout" value="true"/>
        <replace file="${chrome_extension.folder}/${project_name}/about.html" token="@build_version" value="${build.version}"/>
        <replace file="${chrome_extension.folder}/${project_name}/manifest.json" token="@build_version" value="${build.version}"/>

        <replace file="${chrome_extension.folder}/${project_name}/remote.html" token="@manifest" value=''/>
        <replace file="${chrome_extension.folder}/${project_name}/settings.html" token="@manifest" value=''/>

        <zip destfile="${chrome_extension.folder}/${project_name}.zip"
             basedir="${chrome_extension.folder}/${project_name}/"
                />

    </target>


	<target name="clean" description="clean up, remove target folder">
		<delete dir="${target.folder}" />
	</target>

    <target name="run" description="Run remote control in a web browser">
        <exec executable="${browser.path}" spawn="true">
            <arg value="${target.folder}/${project_name}/remote.html"/>
        </exec>
    </target>


    <target name="package" depends="clean, package_web, package_chrome_extension" description="Package all">

    </target>


</project>
